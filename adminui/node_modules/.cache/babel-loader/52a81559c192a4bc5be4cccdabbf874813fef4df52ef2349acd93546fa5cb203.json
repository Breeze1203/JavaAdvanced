{"ast":null,"code":"import request from \"@/util/requestUtil\";\nimport { ElMessage, ElMessageBox } from \"element-plus\";\nexport default {\n  name: 'UseSet',\n  data() {\n    return {\n      tree: [],\n      dialogVisible: false,\n      userData: [],\n      nodeName: '',\n      defaultProps: {\n        label: 'name',\n        children: 'children'\n      },\n      // 添加节点要用到的对象\n      addOrganization: {\n        id: null,\n        name: null,\n        parentId: null\n      }\n    };\n  },\n  methods: {\n    // 初始化组织架构节点\n    initOrganization() {\n      request.initOrganization().then(resp => {\n        if (resp.data) {\n          this.tree = resp.data;\n        }\n      });\n    },\n    // 初始化所有用户信息\n    initAllUser() {\n      request.initAllUser().then(resp => {\n        if (resp.data) {\n          this.userData = resp.data;\n        }\n      });\n    },\n    add(data) {\n      this.dialogVisible = true;\n      this.nodeName = data.name;\n      this.addOrganization.parentId = data.id;\n    },\n    // 确定添加node\n    sureAdd() {\n      if (this.addOrganization.name === null) {\n        ElMessage.error(\"请输入节点名称\");\n        return;\n      }\n      request.addNode(this.addOrganization).then(resp => {\n        if (resp.data.code === 200) {\n          ElMessage.success(resp.data.message);\n          this.initOrganization();\n        } else {\n          ElMessage.error(resp.data.message);\n        }\n      });\n      this.dialogVisible = false;\n    },\n    //取消添加\n    cancelAdd() {\n      this.dialogVisible = false;\n      this.addOrganization.name = null;\n    },\n    // 删除组织\n    Delete(data) {\n      if (data.children.length > 0) {\n        ElMessage.error(\"操作失败，该节点下有子节点\");\n        return;\n      }\n      ElMessageBox.confirm('此操作将永久删除【' + data.name + '】节点，是否继续?', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        console.log(data.id);\n        request.deleteNode(data.id).then(resp => {\n          if (resp.data.code === 200) {\n            ElMessage.success(resp.data.message);\n            // 重新初始化用户架构\n            this.initOrganization();\n          } else {\n            ElMessage.error(resp.data.message);\n          }\n        });\n      }).catch(() => {\n        ElMessage({\n          type: 'info',\n          message: '取消操作'\n        });\n      });\n    }\n  },\n  mounted() {\n    this.initOrganization();\n    this.initAllUser();\n  }\n};","map":{"version":3,"names":["request","ElMessage","ElMessageBox","name","data","tree","dialogVisible","userData","nodeName","defaultProps","label","children","addOrganization","id","parentId","methods","initOrganization","then","resp","initAllUser","add","sureAdd","error","addNode","code","success","message","cancelAdd","Delete","length","confirm","confirmButtonText","cancelButtonText","type","console","log","deleteNode","catch","mounted"],"sources":["/Users/pt/Documents/code/adminflowui/src/components/set/UserSet.vue"],"sourcesContent":["<template>\n  <div class=\"common-layout\" style=\"margin-top: 25px\">\n    <el-container class=\"shadow-box\">\n      <el-aside width=\"200px\">\n        <div style=\"border-bottom: 1px solid;text-align: center\">\n          <h4>用户架构</h4>\n        </div>\n        <div style=\"margin-top: 25px\">\n          <el-tree @node-click=\"handleNodeClick\" :default-expand-all=\"true\" :props=\"defaultProps\" :data=\"tree\">\n            <template #default=\"{ node, data }\">\n              <span>{{ node.label }}</span>\n              <el-dropdown size=\"small\" trigger=\"hover\">\n                <el-icon>\n                  <Setting/>\n                </el-icon>\n                <template #dropdown>\n                  <el-dropdown-menu>\n                    <el-dropdown-item @click=\"add(data)\">添加</el-dropdown-item>\n                    <el-dropdown-item @click=\"Delete(data)\">删除</el-dropdown-item>\n                  </el-dropdown-menu>\n                </template>\n              </el-dropdown>\n            </template>\n          </el-tree>\n        </div>\n      </el-aside>\n      <el-container>\n        <el-header>Header</el-header>\n        <el-main>\n          <el-table stripe border style=\"width: 100%\" :data=\"userData\">\n            <el-table-column align=\"center\" prop=\"id\" label=\"id\" width=\"90\"/>\n            <el-table-column align=\"center\" prop=\"username\" label=\"姓名\" width=\"90\"/>\n            <el-table-column align=\"center\" prop=\"address\" label=\"地址\" width=\"90\"/>\n            <el-table-column align=\"center\" prop=\"organization.name\" label=\"所属节点\" width=\"90\"/>\n            <el-table-column align=\"center\" label=\"头像\" width=\"100\">\n              <template #default=\"scope\">\n                <el-avatar size=\"small\" :src=\"scope.row.userFace\"/>\n              </template>\n            </el-table-column>\n            <el-table-column align=\"center\" prop=\"embod\" label=\"个性签名\" width=\"180\"/>\n            <el-table-column align=\"center\" label=\"状态\" width=\"90\">\n              <template #default=\"scope\">\n                <el-tag type=\"success\" v-if=\"scope.row.state\">启用</el-tag>\n                <el-tag type=\"danger\" v-else>禁用</el-tag>\n              </template>\n            </el-table-column>\n            <el-table-column align=\"center\" prop=\"email\" label=\"邮箱\" width=\"150\"/>\n            <el-table-column align=\"center\" label=\"操作\" width=\"200\">\n              <template #default>\n                <span style=\"margin-right: 10px;\"><el-icon><Lock /></el-icon>禁用</span>\n                <span style=\"margin-right: 10px;\"><el-icon><Edit /></el-icon>修改</span>\n                <span style=\"margin-right: 10px;color: red\"><el-icon><Delete /></el-icon>删除</span>\n              </template>\n            </el-table-column>\n          </el-table>\n        </el-main>\n      </el-container>\n    </el-container>\n  </div>\n  <el-dialog\n      v-model=\"dialogVisible\"\n      title=\"增加节点\"\n      width=\"25%\">\n    <el-row>\n      <el-col :span=\"12\">\n        <span>上级节点：</span>\n      </el-col>\n      <el-col :span=\"12\">\n        <el-input v-model=\"nodeName\" size=\"small\" disabled/>\n      </el-col>\n    </el-row>\n    <el-row style=\"margin-top: 25px\">\n      <el-col :span=\"12\">\n        <span>名称</span>\n      </el-col>\n      <el-col :span=\"12\">\n        <el-input v-model=\"addOrganization.name\" size=\"small\"/>\n      </el-col>\n    </el-row>\n    <template #footer>\n      <span class=\"dialog-footer\">\n        <el-button size=\"small\" @click=\"cancelAdd\">取消</el-button>\n        <el-button size=\"small\" type=\"primary\" @click=\"sureAdd\">\n          确定\n        </el-button>\n      </span>\n    </template>\n  </el-dialog>\n</template>\n<script>\nimport request from \"@/util/requestUtil\";\nimport {ElMessage, ElMessageBox} from \"element-plus\";\n\nexport default {\n  name: 'UseSet',\n  data() {\n    return {\n      tree: [],\n      dialogVisible: false,\n      userData: [],\n      nodeName: '',\n      defaultProps: {\n        label: 'name',\n        children: 'children',\n      },\n      // 添加节点要用到的对象\n      addOrganization: {\n        id: null,\n        name: null,\n        parentId: null,\n      }\n    }\n  },\n  methods: {\n    // 初始化组织架构节点\n    initOrganization() {\n      request.initOrganization().then(resp => {\n        if (resp.data) {\n          this.tree = resp.data;\n        }\n      })\n    },\n    // 初始化所有用户信息\n    initAllUser() {\n      request.initAllUser().then(resp => {\n        if (resp.data) {\n          this.userData = resp.data;\n        }\n      })\n    },\n    add(data) {\n      this.dialogVisible = true;\n      this.nodeName = data.name;\n      this.addOrganization.parentId=data.id;\n    },\n    // 确定添加node\n    sureAdd(){\n      if(this.addOrganization.name===null){\n        ElMessage.error(\"请输入节点名称\");\n        return;\n      }\n      request.addNode(this.addOrganization).then(resp=>{\n            if(resp.data.code===200){\n              ElMessage.success(resp.data.message);\n              this.initOrganization();\n            }else {\n              ElMessage.error(resp.data.message);\n            }\n      })\n      this.dialogVisible = false;\n    },\n    //取消添加\n    cancelAdd(){\n      this.dialogVisible=false;\n      this.addOrganization.name=null},\n    // 删除组织\n    Delete(data) {\n      if (data.children.length > 0) {\n        ElMessage.error(\"操作失败，该节点下有子节点\");\n        return;\n      }\n      ElMessageBox.confirm(\n          '此操作将永久删除【' + data.name + '】节点，是否继续?',\n          {\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            type: 'warning'\n          }\n      )\n          .then(() => {\n            console.log(data.id)\n            request.deleteNode(data.id).then(resp => {\n              if (resp.data.code === 200) {\n                ElMessage.success(resp.data.message);\n                // 重新初始化用户架构\n                this.initOrganization();\n              } else {\n                ElMessage.error(resp.data.message);\n              }\n            })\n          })\n          .catch(() => {\n            ElMessage({\n              type: 'info',\n              message: '取消操作'\n            })\n          })\n\n    }\n  },\n  mounted() {\n    this.initOrganization();\n    this.initAllUser();\n  }\n}\n</script>\n\n<style scoped>\n.shadow-box {\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4); /* 设置阴影效果 */\n  border: 1px solid #ccc; /* 设置边框 */\n  padding: 20px; /* 设置内边距，可根据需要进行调整 */\n}\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}